var Mode,Status;!function(t){t[t.All=0]="All",t[t.Essential=1]="Essential",t[t.Selected=2]="Selected"}(Mode=Mode||{}),function(t){t.Selected="s",t.All="a"}(Status=Status||{});var Supi=function(){function t(){var e=this;this.cookieName="supi-status",this.cookieAllowed="supi-allowed",this.overlay=!1,this.allowed=[],this.ttlAll=30,this.ttlReduced=7,this.allowAll=!1,this.root=document.getElementById("supi"),this.dismiss=this.get("#supi__dismiss"),this.choose=this.get("#supi__choose",!0),this.banner=this.get("#supi__overlay")?this.get("#supi__overlay"):this.get("#supi__banner"),this.overlay=!!this.get("#supi__overlay"),this.body=document.getElementsByTagName("body")[0],this.config=JSON.parse(this.root.getAttribute("data-supi-config")),this.switch=this.get("#supi__switchTo"),this.save=this.get("#supi__save"),this.config.cookieTTL&&(this.ttlReduced=parseInt(this.config.cookieTTL.reduced)||this.ttlReduced,this.ttlAll=parseInt(this.config.cookieTTL.allow)||this.ttlAll);try{var t=this.getCookie(this.cookieAllowed);if(t&&t.length){var i=JSON.parse(t);Array.isArray(i)&&(this.allowed=i)}}catch(t){}this.config.essential.names.split(",").forEach(function(t){-1===e.allowed.indexOf(t)&&e.allowed.push(t)}),this.getCookie(this.cookieName)===Status.All?(this.allowAll=!0,this.injectJavaScripts(),this.updateCookieTTL()):this.getCookie(this.cookieName)===Status.Selected?(this.injectJavaScripts(),this.updateCookieTTL()):this.toggleBanner(),this.addClickHandler()}return t.prototype.updateCookieTTL=function(){this.setCookie(this.cookieName,this.getCookie(this.cookieName)),this.setCookie(this.cookieAllowed,this.getCookie(this.cookieAllowed))},t.prototype.addClickHandler=function(){var s=this;this.find("[data-toggle=allow]").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),s.allowAll=!0,s.collectAllowed(Mode.All),s.removeScripts(),!0===s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.All))})}),this.dismiss&&this.dismiss.addEventListener("click",function(t){t.preventDefault(),s.collectAllowed(Mode.Essential)&&s.removeScripts(),!0===s.removeScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected))}),this.save&&this.save.addEventListener("click",function(t){t.preventDefault(),s.collectAllowed(Mode.Selected),s.removeScripts(),s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected))}),this.choose&&this.choose.addEventListener("click",function(t){t.preventDefault(),s.toggleBanner()}),this.find("[data-toggle=switch]").filter(function(t){return s.get(t.dataset.switchFrom)&&s.get(t.dataset.switchTo)}).forEach(function(e){e.addEventListener("click",function(t){s.get(e.dataset.switchFrom).classList.add("tx-supi__pane-hidden"),s.get(e.dataset.switchTo).classList.remove("tx-supi__pane-hidden"),"disable"===e.dataset.inputs&&s.find("input[type=checkbox]").forEach(function(t){t.checked=t.disabled||!!t.dataset.required}),t.preventDefault()})}),this.find("[data-toggle=visibility]").filter(function(t){return!!s.get(t.dataset.target)}).forEach(function(e){e.addEventListener("click",function(t){e.classList.toggle("tx-supi__pane-active"),s.get(e.dataset.target).classList.toggle("tx-supi__pane-hidden"),t.preventDefault()})}),this.find("input[data-supi-block]").filter(function(t){return!t.disabled}).forEach(function(o){o.addEventListener("click",function(t){if(o.dataset.supiParent)s.find("[data-supi-block="+o.dataset.supiBlock+"]").forEach(function(t){t.dataset.supiParent||(t.checked=o.checked)});else{var e=s.get("[data-supi-parent="+o.dataset.supiBlock+"]"),i=s.find("[data-supi-block="+o.dataset.supiBlock+"]").filter(function(t){return!!t.dataset.supiItem});e&&i.length&&(e.checked=i.reduce(function(t,e){return t&&e.checked},!0))}t.stopPropagation()})})},t.prototype.injectJavaScripts=function(){var i=this;return[].slice.call(document.getElementsByTagName("script"),0).filter(function(t){return"application/supi"==t.type}).filter(function(t){var e=i.allowAll||!!t.dataset.supiRequired;return!e&&t.dataset.supiCookies&&(e=t.dataset.supiCookies.split(",").reduce(function(t,e){return t||-1<i.allowed.indexOf(e)},!1)),e}).forEach(function(t){var e=document.createElement("script");e.type="text/javascript",e.className="supi-scripts",e.dataset.supiCookies=t.dataset.supiCookies,e.innerHTML=t.innerHTML,t.parentNode.replaceChild(e,t)}),!0},t.prototype.find=function(t){return[].slice.call(this.root.querySelectorAll(t),0)},t.prototype.get=function(t,e){return void 0===e&&(e=!1),(e?document:this.root).querySelector(t)},t.prototype.toggleBanner=function(){!0===this.overlay&&this.body.classList.toggle("tx-supi__overlay"),this.banner.classList.toggle("hide")},t.prototype.removeScripts=function(){return[].slice.call(document.getElementsByClassName("supi-scripts"),0).forEach(function(t){var e=document.createElement("script");e.type="application/supi",e.dataset.supiCookies=t.dataset.supiCookies,e.innerHTML=t.innerHTML,t.parentNode.replaceChild(e,t)}),this.deleteAllCookies(),!0},t.prototype.setCookie=function(t,e){var i=new Date,o=encodeURIComponent(e),s=this.allowAll?this.ttlAll:this.ttlReduced;i.setTime(i.getTime()+24*s*60*60*1e3),document.cookie=encodeURIComponent(t)+"="+o+"; expires="+i.toUTCString()+"; path=/"},t.prototype.getCookie=function(t){var e=("; "+document.cookie).split("; "+encodeURIComponent(t)+"=");if(2!=e.length)return"";var i=e.pop().split(";").shift();return decodeURIComponent(i)},t.prototype.deleteCookie=function(t){var e=new Date;e.setTime(e.getTime()+-864e5),document.cookie=t+"=; expires="+e.toUTCString()+"; path=/"},t.prototype.deleteAllCookies=function(){var i=this;document.cookie.split("; ").forEach(function(t){var e=t.split("=").shift();i.allowAll&&-1!==i.allowed.indexOf(e)||i.deleteCookie(e)})},t.prototype.collectAllowed=function(t){var i=this;void 0===t&&(t=Mode.Essential);var e=this.allowed.sort().join();switch(this.allowed=[],t){case Mode.All:Object.keys(this.config).forEach(function(t){var e;null!==(e=i.config[t])&&void 0!==e&&e.names.split().forEach(function(t){i.allowed.push(t)})});break;case Mode.Essential:Object.keys(this.config).filter(function(t){return!!i.config[t].required}).forEach(function(t){var e;null!==(e=i.config[t])&&void 0!==e&&e.names.split().forEach(function(t){i.allowed.push(t)})});break;case Mode.Selected:this.find("input[type=checkbox]").filter(function(t){return t.checked||0<(parseInt(t.dataset.supiRequired)||0)}).map(function(t){return t.value}).forEach(function(t){t.split(",").map(function(t){return t.trim()}).forEach(function(t){-1===i.allowed.indexOf(t)&&i.allowed.push(t)})})}return setTimeout(function(){i.setCookie(i.cookieAllowed,JSON.stringify(i.allowed))},300),this.allowed.sort().join()===e},t}();window.onload=function(){document.getElementById("supi")&&new Supi};
//# sourceMappingURL=Supi.min.js.map
