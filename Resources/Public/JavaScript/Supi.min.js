var Mode,Status;!function(e){e[e.All=0]="All",e[e.Essential=1]="Essential",e[e.Selected=2]="Selected"}(Mode=Mode||{}),function(e){e.Selected="s",e.All="a"}(Status=Status||{});var Supi=function(){function e(){var t=this;this.cookieName="supi-status",this.cookieAllowed="supi-allowed",this.overlay=!1,this.allowed=[],this.ttlAll=30,this.ttlReduced=7,this.allowAll=!1,this.allowYoutube=!1,this.root=document.getElementById("supi"),this.dismiss=this.get("#supi__dismiss"),this.choose=this.get("#supi__choose",!0),this.banner=this.get("#supi__overlay")?this.get("#supi__overlay"):this.get("#supi__banner"),this.overlay=!!this.get("#supi__overlay"),this.body=document.getElementsByTagName("body")[0],this.config=JSON.parse(this.root.getAttribute("data-supi-config")),this.switch=this.get("#supi__switchTo"),this.save=this.get("#supi__save"),this.config.cookieTTL&&(this.ttlReduced=parseInt(this.config.cookieTTL.reduced)||this.ttlReduced,this.ttlAll=parseInt(this.config.cookieTTL.allow)||this.ttlAll);try{var e=this.getCookie(this.cookieAllowed);if(e&&e.length){var i=JSON.parse(e);Array.isArray(i)&&(this.allowed=i)}}catch(e){}this.config.essential.names.split(",").forEach(function(e){-1===t.allowed.indexOf(e)&&t.allowed.push(e)}),this.getCookie(this.cookieName)===Status.All||"0"===this.getCookie(this.cookieName)?(this.allowAll=!0,this.injectJavaScripts(),this.updateCookieTTL()):this.getCookie(this.cookieName)===Status.Selected||"1"===this.getCookie(this.cookieName)?(this.injectJavaScripts(),this.updateCookieTTL()):""===this.getCookie(this.cookieName)&&(this.deleteCookie(this.cookieName),this.get('[data-hide-overlay="1"]',!0)?this.log('Hides the Banner-Overlay due to the given Setting "hideOverlayOnButtonCe"',"",""):this.toggleBanner()),this.log("Checking for yt cookie"),this.allowYoutube="y"===this.getCookie("supi-yt"),this.log('Cookie is "%o" resulting in %o',this.getCookie("supi-yt"),this.allowYoutube),this.enableYoutubeVideos(),this.addClickHandler(),this.setDetailDefaults()}return e.prototype.updateCookieTTL=function(){this.setCookie(this.cookieName,this.getCookie(this.cookieName)),this.setCookie(this.cookieAllowed,this.getCookie(this.cookieAllowed))},e.prototype.addClickHandler=function(){var s=this;this.find("[data-toggle=allow]").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),s.allowAll=!0,s.collectAllowed(Mode.All),s.removeScripts(),!0===s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.All)),s.setDetailDefaults()})}),this.dismiss&&this.dismiss.addEventListener("click",function(e){e.preventDefault(),s.collectAllowed(Mode.Essential)&&s.removeScripts(),!0===s.removeScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected)),s.setDetailDefaults()}),this.save&&this.save.addEventListener("click",function(e){e.preventDefault(),s.collectAllowed(Mode.Selected),s.removeScripts(),s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected))}),this.choose&&this.choose.addEventListener("click",function(e){e.preventDefault(),s.toggleBanner()}),this.find("[data-toggle=switch]").filter(function(e){return s.get(e.dataset.switchFrom)&&s.get(e.dataset.switchTo)}).forEach(function(t){t.addEventListener("click",function(e){s.get(t.dataset.switchFrom).classList.add("tx-supi__pane-hidden"),s.get(t.dataset.switchTo).classList.remove("tx-supi__pane-hidden"),"disable"===t.dataset.inputs&&s.allowed.length<1&&s.find("input[type=checkbox]").forEach(function(e){e.checked=e.disabled||!!e.dataset.required}),e.preventDefault()})}),this.find("[data-toggle=visibility]").filter(function(e){return!!s.get(e.dataset.target)}).forEach(function(t){t.addEventListener("click",function(e){t.classList.toggle("tx-supi__pane-active"),s.get(t.dataset.target).classList.toggle("tx-supi__pane-hidden"),e.preventDefault()})}),this.find("input[data-supi-block]").filter(function(e){return!e.disabled}).forEach(function(o){o.addEventListener("click",function(e){if(o.dataset.supiParent)s.find("[data-supi-block="+o.dataset.supiBlock+"]").forEach(function(e){e.dataset.supiParent||(e.checked=o.checked)});else{var t=s.get("[data-supi-parent="+o.dataset.supiBlock+"]"),i=s.find("[data-supi-block="+o.dataset.supiBlock+"]").filter(function(e){return!!e.dataset.supiItem});t&&i.length&&(t.checked=i.reduce(function(e,t){return e&&t.checked},!0))}e.stopPropagation()})}),this.findAll(".tx-supi__youtube").forEach(function(e){s.log("Add listener to child of %o",e),e.querySelector("[data-toggle=youtube]").addEventListener("click",function(){s.log("Enabling all"),s.toggleYoutubeVideos(e)})})},e.prototype.injectJavaScripts=function(){var i=this;return[].slice.call(document.getElementsByTagName("script"),0).filter(function(e){return"application/supi"==e.type}).filter(function(e){var t=i.allowAll||!!e.dataset.supiRequired;return!t&&e.dataset.supiCookies&&(t=e.dataset.supiCookies.split(",").reduce(function(e,t){return e||-1<i.allowed.indexOf(t)},!1)),t}).forEach(function(e){var t=document.createElement("script");t.type="text/javascript",t.className="supi-scripts",t.dataset.supiCookies=e.dataset.supiCookies,t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)}),!0},e.prototype.find=function(e){return[].slice.call(this.root.querySelectorAll(e),0)},e.prototype.findAll=function(e){return[].slice.call(document.querySelectorAll(e),0)},e.prototype.get=function(e,t){return void 0===t&&(t=!1),(t?document:this.root).querySelector(e)},e.prototype.toggleBanner=function(){!0===this.overlay&&this.body.classList.toggle("tx-supi__overlay"),this.banner.classList.toggle("hide")},e.prototype.removeScripts=function(){return[].slice.call(document.getElementsByClassName("supi-scripts"),0).forEach(function(e){var t=document.createElement("script");t.type="application/supi",t.dataset.supiCookies=e.dataset.supiCookies,t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)}),this.deleteAllCookies(),!0},e.prototype.setCookie=function(e,t){var i=new Date,o=encodeURIComponent(t),s=this.allowAll?this.ttlAll:this.ttlReduced;i.setTime(i.getTime()+24*s*60*60*1e3),document.cookie=encodeURIComponent(e)+"="+o+"; expires="+i.toUTCString()+"; path=/",sessionStorage.setItem(e,t)},e.prototype.getCookie=function(e){if(sessionStorage.hasOwnProperty(e))return sessionStorage.getItem(e);var t=("; "+document.cookie).split("; "+encodeURIComponent(e)+"=");if(2!=t.length)return"";var i=t.pop().split(";").shift();return decodeURIComponent(i)},e.prototype.deleteCookie=function(e){var t=new Date;t.setTime(t.getTime()+-864e5),document.cookie=e+"=; expires="+t.toUTCString()+"; path=/",sessionStorage.removeItem(e)},e.prototype.deleteAllCookies=function(){var i=this;this.allowAll||document.cookie.split("; ").forEach(function(e){var t=e.split("=").shift();-1===i.allowed.indexOf(t)&&(i.deleteCookie(t),sessionStorage.removeItem(t))})},e.prototype.collectAllowed=function(e){var i=this;void 0===e&&(e=Mode.Essential);var t=this.allowed.sort().join();switch(this.allowed=[],e){case Mode.All:Object.keys(this.config).forEach(function(e){var t;null!==(t=i.config[e])&&void 0!==t&&t.names.split().forEach(function(e){i.allowed.push(e)})});break;case Mode.Essential:Object.keys(this.config).filter(function(e){return!!i.config[e].required}).forEach(function(e){var t;null!==(t=i.config[e])&&void 0!==t&&t.names.split().forEach(function(e){i.allowed.push(e)})});break;case Mode.Selected:this.find("input[type=checkbox]").filter(function(e){return e.checked||0<(parseInt(e.dataset.supiRequired)||0)}).map(function(e){return e.value}).forEach(function(e){e.split(",").map(function(e){return e.trim()}).forEach(function(e){-1===i.allowed.indexOf(e)&&i.allowed.push(e)})})}return setTimeout(function(){i.setCookie(i.cookieAllowed,JSON.stringify(i.allowed))},300),this.allowed.sort().join()===t},e.prototype.setDetailDefaults=function(){var i=this;this.find("input[data-supi-parent]").forEach(function(e){var t=i.find("input[data-supi-block="+e.dataset.supiParent+"][data-supi-item]");t.length?(e.checked=!0,t.forEach(function(e){e.checked=e.disabled||i.allowAll||e.value.split(",").reduce(function(e,t){return e&&-1<i.allowed.indexOf(t)},!0)}),e.checked=t.reduce(function(e,t){return e&&t.checked},!0),i.log("Set parent %o to %o",e,e.checked)):(i.log("Check if all of parent values %s",e.value,i.allowed),e.checked=e.disabled||i.allowAll||e.value.split(",").reduce(function(e,t){return i.log("Checking value %s with prev of %o",t,e),e&&(t=t.replace(/\s+/g,""),i.log("Prev still true, checking if value %s is in %o",t,i.allowed),""!==t&&-1===i.allowed.indexOf(t)&&(i.log("Value %s is not in %o, setting to false",t,i.allowed),e=!1)),e},!0))})},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.body.classList.contains("develop")&&console.log.apply(console,e)},e.prototype.enableYoutubeVideos=function(){var t=this;(this.allowAll||this.allowYoutube)&&(this.log("Enabling all videos, non autostart"),this.findAll(".tx-supi__youtube").forEach(function(e){t.log("Enabling %o",e),t.addVideo(e,"")}))},e.prototype.toggleYoutubeVideos=function(e){this.log("Enabling youtube"),this.allowYoutube=!0,this.setCookie("supi-yt","y"),this.log("Start video for %o",e),this.addVideo(e,"&autoplay=1"),this.log("Enabling other videos"),this.enableYoutubeVideos()},e.prototype.addVideo=function(e,t){var i=e.querySelector(".tx-supi__youtube-preview-image").getBoundingClientRect(),o="https://www.youtube-nocookie.com/embed/"+e.dataset.youtubeId+"?rel=0&modestbranding=1"+t,s=document.createElement("iframe");s.src=o,s.frameBorder="0",s.style.border="0",s.width=i.width+"",s.height=i.height+"",e.parentNode.replaceChild(s,e)},e}();window.onload=function(){document.getElementById("supi")&&new Supi};
//# sourceMappingURL=Supi.min.js.map
