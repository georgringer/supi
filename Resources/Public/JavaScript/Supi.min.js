var Mode,Status;!function(t){t[t.All=0]="All",t[t.Essential=1]="Essential",t[t.Selected=2]="Selected"}(Mode=Mode||{}),function(t){t.Selected="sel",t.All="all"}(Status=Status||{});var Supi=function(){function t(){var e=this;if(this.cookieName="supi-status",this.cookieAllowed="supi-allowed",this.overlay=!1,this.allowed=[],this.ttl=7,this.allowAll=!1,this.root=document.getElementById("supi"),this.dismiss=this.get("#supi__dismiss"),this.choose=this.get("#supi__choose"),this.banner=this.get("#supi__overlay")?this.get("#supi__overlay"):this.get("#supi__banner"),this.overlay=!!this.get("#supi__overlay"),this.body=document.getElementsByTagName("body")[0],this.config=JSON.parse(this.root.getAttribute("data-supi-config")),this.switch=this.get("#supi__switchTo"),this.save=this.get("#supi__save"),this.config.cookieTTL){var t=parseInt(this.config.cookieTTL)||0;0<t&&(this.ttl=t)}try{var i=this.getCookie(this.cookieAllowed);if(i&&i.length){var o=JSON.parse(i);Array.isArray(o)&&(this.allowed=o)}}catch(t){}this.config.essential.names.split(",").forEach(function(t){-1===e.allowed.indexOf(t)&&e.allowed.push(t)}),this.getCookie(this.cookieName)===Status.All?(this.allowAll=!0,this.injectJavaScripts()):this.getCookie(this.cookieName)===Status.Selected?this.injectJavaScripts():this.toggleBanner(),this.addClickHandler()}return t.prototype.addClickHandler=function(){var s=this;this.find("[data-toggle=allow]").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),s.allowAll=!0,s.collectAllowed(Mode.All),s.removeScripts(),!0===s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.All))})}),this.dismiss&&this.dismiss.addEventListener("click",function(t){t.preventDefault(),s.collectAllowed(Mode.Essential)&&s.removeScripts(),!0===s.removeScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected))}),this.save&&this.save.addEventListener("click",function(t){t.preventDefault(),s.collectAllowed(Mode.Selected),s.removeScripts(),s.injectJavaScripts()&&(s.toggleBanner(),s.setCookie(s.cookieName,Status.Selected))}),this.choose&&this.choose.addEventListener("click",function(t){t.preventDefault(),s.toggleBanner()}),this.find("[data-toggle=switch]").filter(function(t){return s.get(t.dataset.switchFrom)&&s.get(t.dataset.switchTo)}).forEach(function(e){e.addEventListener("click",function(t){s.get(e.dataset.switchFrom).classList.add("tx-supi__pane-hidden"),s.get(e.dataset.switchTo).classList.remove("tx-supi__pane-hidden"),"disable"===e.dataset.inputs&&s.find("input[type=checkbox]").forEach(function(t){t.checked=t.disabled||!!t.dataset.required}),t.preventDefault()})}),this.find("[data-toggle=visibility]").filter(function(t){return!!s.get(t.dataset.target)}).forEach(function(e){e.addEventListener("click",function(t){e.classList.toggle("tx-supi__pane-active"),s.get(e.dataset.target).classList.toggle("tx-supi__pane-hidden"),t.preventDefault()})}),this.find("input[data-supi-block]").filter(function(t){return!t.disabled}).forEach(function(o){o.addEventListener("click",function(t){if(o.dataset.supiParent)s.find("[data-supi-block="+o.dataset.supiBlock+"]").forEach(function(t){t.dataset.supiParent||(t.checked=o.checked)});else{var e=s.get("[data-supi-parent="+o.dataset.supiBlock+"]"),i=s.find("[data-supi-block="+o.dataset.supiBlock+"]").filter(function(t){return!!t.dataset.supiItem});e.checked=i.reduce(function(t,e){return t&&e.checked},!0)}t.stopPropagation()})})},t.prototype.injectJavaScripts=function(){var i=this;return[].slice.call(document.getElementsByTagName("script"),0).filter(function(t){return"application/supi"==t.type}).filter(function(t){var e=i.allowAll||!!t.dataset.supiRequired;return!e&&t.dataset.supiCookies&&(e=t.dataset.supiCookies.split(",").reduce(function(t,e){return t||-1<i.allowed.indexOf(e)},!1)),e}).forEach(function(t){var e=document.createElement("script");e.type="text/javascript",e.className="supi-scripts",e.dataset.supiCookies=t.dataset.supiCookies,e.dataset.src=t.innerHTML,e.innerHTML=t.innerHTML,t.parentNode.replaceChild(e,t)}),!0},t.prototype.find=function(t){return[].slice.call(this.root.querySelectorAll(t),0)},t.prototype.get=function(t){return this.root.querySelector(t)},t.prototype.toggleBanner=function(){!0===this.overlay&&this.body.classList.toggle("overlay"),this.banner.classList.toggle("hide")},t.prototype.removeScripts=function(){return[].slice.call(document.getElementsByClassName("supi-scripts"),0).forEach(function(t){var e=document.createElement("script");e.type="application/supi",e.dataset.supiCookies=t.dataset.supiCookies,e.dataset.innerHTML=t.dataset.src||t.innerHTML,t.parentNode.replaceChild(e,t)}),this.deleteAllCookies(),!0},t.prototype.setCookie=function(t,e){var i=new Date,o=encodeURIComponent(e);i.setTime(i.getTime()+24*this.ttl*60*60*1e3),document.cookie=t+"="+o+"; expires="+i.toUTCString()+"; path=/"},t.prototype.getCookie=function(t){var e=("; "+document.cookie).split("; "+t+"=");if(2!=e.length)return"";var i=e.pop().split(";").shift();return decodeURIComponent(i)},t.prototype.deleteCookie=function(t){var e=new Date;e.setTime(e.getTime()+-864e5),document.cookie=t+"=; expires="+e.toUTCString()+"; path=/"},t.prototype.deleteAllCookies=function(){var i=this;document.cookie.split("; ").forEach(function(t){var e=t.split("=")[0];-1===i.allowed.indexOf(e)&&i.deleteCookie(e)})},t.prototype.collectAllowed=function(t){var e=this;void 0===t&&(t=Mode.Essential);var i=this.allowed.sort().join();switch(this.allowed=[],t){case Mode.All:Object.keys(this.config).forEach(function(t){e.config[t].names.split().forEach(function(t){e.allowed.push(t)})});break;case Mode.Essential:Object.keys(this.config).filter(function(t){return!!e.config[t].required}).forEach(function(t){e.config[t].names.split().forEach(function(t){e.allowed.push(t)})});break;case Mode.Selected:this.find("[data-supi-item]").filter(function(t){return t.checked||0<(parseInt(t.dataset.supiRequired)||0)}).map(function(t){return t.value}).forEach(function(t){t.split(",").forEach(function(t){-1===e.allowed.indexOf(t)&&e.allowed.push(t)})})}return this.setCookie(this.cookieAllowed,JSON.stringify(this.allowed)),this.allowed.sort().join()===i},t}();window.onload=function(){document.getElementById("supi")&&new Supi};
//# sourceMappingURL=Supi.min.js.map
